import RPi.GPIO as GPIO
import time
from datetime import datetime
import mysql.connector
from mysql.connector import Error

#Establish Database Connection


'''connection = mysql.connector.connect(
    host = "localhost",
    user = "rebuxphpdbadmin",
    password = "rebuxphpdbadminpassword",
    database = "RebuxDB"
)



cursor = connection.cursor()

'''


def item_details():
    
    '''item_id = cursor.execute("SELECT item_id FROM Item");
    myresult = mycursor.fetchone()
    increment_item_id = item_id + 1;
    print(increment_item_id);
    '''
    item_description = input("Enter the details of deposited lost item: ")
    print("Item 1013 was deposited at " + formatted_datetime_retrieved + "Description is " + item_description)
    

#Testing functions
sensor = 4  #IR Sensor connected to GPIO4
buzzer = 21 #Positive terminal of buzzer connected to GPIO21 connect to GPIO Board

GPIO.setmode(GPIO.BCM) #BCM Refers to the labelled pins OF THE T-cobbler connected to Rasp Pi
GPIO.setup(sensor,GPIO.IN)
GPIO.setup(buzzer,GPIO.OUT)

GPIO.output(buzzer,True)
print ("IR Sensor Ready...")
print (" ")

pop = 0

try: 
   while True:
      
      
        if (GPIO.input(sensor) == 1):
          
          #time.sleep(3); #I want to fix the issue of it printing when item has been detected but nothing has passed over it yet
          GPIO.output(buzzer,False)
          GPIO.output(buzzer,GPIO.LOW)
          datetime_retrieved = datetime.now();
          formatted_datetime_retrieved= datetime_retrieved.strftime("%m/%d/%Y, %H:%M:%S")
          print ("An item has been placed in the Chute at " + formatted_datetime_retrieved)
          print;
 #         item_details();
          
          


          #These 2 lines prevent the program from running continuously 
          while GPIO.input(sensor):
              print("Detecting for item...")
              time.sleep(0.5)

        else:
          GPIO.output(buzzer,True)
          


except KeyboardInterrupt:
    GPIO.cleanup()
    
    
    
